<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor MP4 a MP3</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h1>üéµ Convertidor MP4 a MP3</h1>
    <div id="drop-zone">
        Arrastra tu archivo MP4 aqu√≠ o haz clic para seleccionar
        <input type="file" id="file-input" accept=".mp4">
    </div>
    <button id="convert-btn" disabled>Convertir a MP3</button>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
    <p id="status"></p>
</div>

<script>
const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');
const convertBtn = document.getElementById('convert-btn');
const progressBar = document.getElementById('progress-bar');
const status = document.getElementById('status');
let selectedFile = null;

// Arrastrar y soltar
dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', e => e.preventDefault());
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) handleFile(fileInput.files[0]);
});

function handleFile(file) {
    if (file.type !== "video/mp4") {
        status.textContent = "Por favor, selecciona un archivo MP4 v√°lido.";
        convertBtn.disabled = true;
        return;
    }
    selectedFile = file;
    status.textContent = `Archivo listo: ${file.name}`;
    convertBtn.disabled = false;
}

convertBtn.addEventListener('click', async () => {
    if (!selectedFile) return;
    convertBtn.disabled = true;
    status.textContent = "‚è≥ Convirtiendo...";
    progressBar.style.width = '0%';

    const formData = new FormData();
    formData.append('file', selectedFile);

    try {
        const response = await fetch('/convert', { method: 'POST', body: formData });
        if (!response.ok) throw new Error(await response.text());

        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'audio.mp3';
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);

        status.textContent = "‚úÖ Conversi√≥n completada.";
    } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Ocurri√≥ un error durante la conversi√≥n.";
    } finally {
        convertBtn.disabled = false;
    }
});
</script>
</body>
</html>
