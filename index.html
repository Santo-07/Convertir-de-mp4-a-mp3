<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Convertidor MP4 a MP3 â€” Sin subir archivos</title>
  <meta name="description" content="Convierte MP4 a MP3 gratis, rÃ¡pido y privado. Todo ocurre en tu navegador; no subimos tus archivos a ningÃºn servidor." />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ðŸŽ§</text></svg>">
  <!-- Schema.org (SoftwareApplication) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Convertidor MP4 a MP3",
    "url": "https://example.com/",
    "applicationCategory": "Multimedia",
    "operatingSystem": "Any",
    "description": "Convierte MP4 a MP3 en el navegador, sin subir archivos.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "EUR"
    }
  }
  </script>
</head>
<body>
  <header class="container">
    <h1>MP4 â†’ MP3 <span class="chip">Gratis</span> <span class="chip">Privado</span></h1>
    <p>La conversiÃ³n ocurre <strong>100% en tu navegador</strong>. Tus archivos <strong>no se suben</strong> a ningÃºn servidor.</p>
  </header>

  <main class="container card">
    <div class="uploader" id="dropzone">
      <input id="file" type="file" accept=".mp4,video/mp4,video/mpeg,video/*" />
      <p>Arrastra y suelta tu vÃ­deo MP4 aquÃ­ o haz clic para elegirlo.</p>
    </div>

    <div class="controls">
      <label for="bitrate">Bitrate MP3:</label>
      <select id="bitrate">
        <option value="128k">128 kbps (ligero)</option>
        <option value="192k" selected>192 kbps (equilibrado)</option>
        <option value="256k">256 kbps</option>
        <option value="320k">320 kbps (mÃ¡xima calidad)</option>
      </select>
      <button id="convert" disabled>Convertir a MP3</button>
    </div>

    <div class="progress">
      <progress id="progress" max="100" value="0"></progress>
      <span id="status">Listo.</span>
    </div>

    <a id="download" class="button hidden" href="#" download="audio.mp3">Descargar MP3</a>
  </main>

  <footer class="container footer">
    <small>Hecho con <a href="https://unpkg.com/@ffmpeg/ffmpeg">ffmpeg.wasm</a>. <a href="privacy.html">Privacidad</a></small>
  </footer>

  <!-- ffmpeg.wasm UMD build from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
 <script>
window.onload = async function() {
  const { createFFmpeg, fetchFile } = FFmpeg;
  const ffmpeg = createFFmpeg({ log: true });

  await ffmpeg.load(); // espera que cargue antes de convertir

  const fileInput = document.getElementById('file');
  const convertBtn = document.getElementById('convert');
  const bitrateSel = document.getElementById('bitrate');
  const progressEl = document.getElementById('progress');
  const statusEl = document.getElementById('status');
  const downloadA = document.getElementById('download');

  convertBtn.disabled = true;

  fileInput.addEventListener('change', () => {
    convertBtn.disabled = !fileInput.files.length;
  });

  convertBtn.addEventListener('click', async () => {
    const file = fileInput.files[0];
    if (!file) return;

    statusEl.textContent = 'Convirtiendo...';
    progressEl.value = 0;

    ffmpeg.setProgress(({ ratio }) => {
      progressEl.value = Math.round(ratio * 100);
    });

    ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));
    await ffmpeg.run('-i', 'input.mp4', '-vn', '-acodec', 'libmp3lame', '-b:a', bitrateSel.value, 'output.mp3');
    const data = ffmpeg.FS('readFile', 'output.mp3');
    const url = URL.createObjectURL(new Blob([data.buffer], { type: 'audio/mpeg' }));

    downloadA.href = url;
    downloadA.download = file.name.replace(/\.[^.]+$/, '') + '.mp3';
    downloadA.classList.remove('hidden');

    statusEl.textContent = 'Â¡Listo! Haz clic en Descargar.';
  });
};
</script>
